<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UnderBunker: The Rescue</title>
    <style>
        /* [ìŠ¤íƒ€ì¼ ì„¤ì •] */
        :root {
            --bg-color: #1a1a1a;
            --card-bg: #f4f4f4;
            --text-color: #333;
            --bar-bg: #444;
            --pop-color: #e74c3c; 
            --food-color: #2ecc71; 
            --def-color: #3498db; 
            --san-color: #9b59b6;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: #fff;
            font-family: 'Pretendard', -apple-system, sans-serif;
            display: flex; flex-direction: column; align-items: center;
            height: 100vh; overflow: hidden;
            user-select: none;
        }

        /* 1. ìƒë‹¨ ì •ë³´ì°½ (ë‚ ì§œ ì¶”ê°€) */
        #top-ui {
            width: 100%; max-width: 500px;
            display: flex; flex-direction: column; align-items: center;
            background-color: rgba(0,0,0,0.6);
            padding-bottom: 10px; z-index: 100;
        }
        #day-counter {
            font-size: 1.5rem; font-weight: 900; color: #f1c40f;
            margin: 10px 0; letter-spacing: 2px;
        }

        /* ìƒíƒœë°” */
        #status-bar {
            display: flex; justify-content: space-around;
            width: 100%; padding: 0 10px; box-sizing: border-box;
        }
        .stat-item { display: flex; flex-direction: column; align-items: center; width: 22%; position: relative;}
        .stat-icon { font-size: 20px; margin-bottom: 5px; z-index: 2; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .progress-container {
            width: 100%; height: 6px; background-color: var(--bar-bg);
            border-radius: 3px; overflow: hidden; position: relative;
        }
        .progress-bar { height: 100%; width: 50%; transition: width 0.3s ease; }

        /* 2. ì¹´ë“œ ì˜ì—­ */
        #game-area {
            flex: 1; display: flex; justify-content: center; align-items: center;
            width: 100%; perspective: 1000px; position: relative;
        }

        #card {
            width: 300px; height: 480px;
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.6);
            display: flex; flex-direction: column; align-items: center;
            padding: 20px; text-align: center; color: var(--text-color);
            position: relative;
            transform-origin: bottom center;
            transition: transform 0.1s linear; 
            will-change: transform;
        }

        /* ì• ë‹ˆë©”ì´ì…˜ */
        .swipe-left { animation: flyLeft 0.5s forwards; }
        .swipe-right { animation: flyRight 0.5s forwards; }
        @keyframes flyLeft { to { transform: translateX(-400px) rotate(-30deg); opacity: 0; } }
        @keyframes flyRight { to { transform: translateX(400px) rotate(30deg); opacity: 0; } }

        /* ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
        #npc-img-container {
            width: 100%; height: 240px;
            margin-bottom: 15px; border-radius: 8px; overflow: hidden;
            background-color: #ddd; display: flex; justify-content: center; align-items: center;
            font-size: 2rem; font-weight: bold; color: #aaa;
        }
        #npc-img { width: 100%; height: 100%; object-fit: cover; display: none; }
        #alt-text { display: block; }

        #npc-name { font-size: 1.1rem; font-weight: 800; margin: 0 0 10px 0; color: #222; text-transform: uppercase; }
        #question-text { font-size: 1rem; line-height: 1.5; flex: 1; display: flex; align-items: center; justify-content: center; word-break: keep-all; padding: 0 10px; color: #444; }

        /* ì˜¤ë²„ë ˆì´ */
        .choice-overlay {
            position: absolute; top: 30px;
            font-size: 2.5rem; font-weight: 900;
            opacity: 0; transition: opacity 0.2s;
            z-index: 10; border: 4px solid; padding: 5px 10px; border-radius: 8px;
            text-transform: uppercase; pointer-events: none;
        }
        .choice-left { left: 20px; color: #e74c3c; border-color: #e74c3c; transform: rotate(-15deg); }
        .choice-right { right: 20px; color: #2ecc71; border-color: #2ecc71; transform: rotate(15deg); }

        /* 3. ë²„íŠ¼ ì˜ì—­ */
        #controls {
            width: 100%; max-width: 400px;
            display: flex; justify-content: space-between;
            padding: 10px 20px 30px 20px;
        }
        .btn {
            flex: 1; padding: 16px; margin: 0 8px;
            border: none; border-radius: 12px;
            font-size: 1rem; font-weight: bold; cursor: pointer; color: white;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2); transition: transform 0.1s;
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .btn:disabled { filter: grayscale(100%); opacity: 0.5; }
        .btn-left { background-color: #e74c3c; }
        .btn-right { background-color: #2ecc71; }

        /* 4. ê²°ê³¼ í™”ë©´ (Game Over / Ending) */
        #result-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 200; text-align: center; color: white;
        }
        .hidden { display: none !important; }
        
        #result-title { font-size: 3rem; margin-bottom: 20px; font-weight: 900;}
        #result-desc { font-size: 1.2rem; margin-bottom: 40px; max-width: 80%; line-height: 1.6; color: #ccc;}
        
        /* ì—”ë”©ìš© ìŠ¤íƒ€ì¼ */
        .ending-win { color: #f1c40f !important; text-shadow: 0 0 20px #f1c40f; }
        
        #restart-btn {
            padding: 15px 50px; font-size: 1.2rem; background: #fff; color: #1a1a1a;
            border: none; border-radius: 50px; cursor: pointer; font-weight: bold;
        }
        #restart-btn:hover { background: #ddd; }

    </style>
</head>
<body>

    <div id="top-ui">
        <div id="day-counter">DAY 1</div>
        <div id="status-bar">
            <div class="stat-item"><span class="stat-icon">ğŸ‘¥</span><div class="progress-container"><div class="progress-bar" id="bar-pop" style="background: var(--pop-color);"></div></div></div>
            <div class="stat-item"><span class="stat-icon">ğŸ¥«</span><div class="progress-container"><div class="progress-bar" id="bar-food" style="background: var(--food-color);"></div></div></div>
            <div class="stat-item"><span class="stat-icon">ğŸ›¡ï¸</span><div class="progress-container"><div class="progress-bar" id="bar-def" style="background: var(--def-color);"></div></div></div>
            <div class="stat-item"><span class="stat-icon">ğŸ§ </span><div class="progress-container"><div class="progress-bar" id="bar-san" style="background: var(--san-color);"></div></div></div>
        </div>
    </div>

    <main id="game-area">
        <div id="card">
            <div class="choice-overlay choice-left" id="overlay-left">NOPE</div>
            <div class="choice-overlay choice-right" id="overlay-right">YEAH</div>
            
            <div id="npc-img-container">
                <span id="alt-text">NPC</span>
                <img id="npc-img" src="" alt="">
            </div>

            <h2 id="npc-name">ìºë¦­í„° ì´ë¦„</h2>
            <p id="question-text">ì§ˆë¬¸ ë‚´ìš©</p>
        </div>
    </main>

    <div id="controls">
        <button class="btn btn-left" id="btn-left">ì™¼ìª½</button>
        <button class="btn btn-right" id="btn-right">ì˜¤ë¥¸ìª½</button>
    </div>

    <div id="result-screen" class="hidden">
        <h1 id="result-title">GAME OVER</h1>
        <p id="result-desc">ê²°ê³¼ ë‚´ìš©</p>
        <button id="restart-btn" onclick="startGame()">ë‹¤ì‹œ ì‹œì‘</button>
    </div>

    <script>
        // [ê²Œì„ ì„¤ì •]
        const TARGET_DAY = 30; // 30ì¼ ìƒì¡´ ì‹œ ì—”ë”© (í…ŒìŠ¤íŠ¸ìš©)

        // [ìŠ¤í† ë¦¬ ì´ë²¤íŠ¸] - íŠ¹ì • ë‚ ì§œì— ê³ ì •ì ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸
        const storyEvents = {
            10: {
                id: 's1', npc: "ë¼ë””ì˜¤", image: "images/radio.png", 
                text: "[DAY 10] ì¹˜ì§... ëˆ„êµ°ê°€ ë“£ê³  ìˆìŠµë‹ˆê¹Œ? ì •ë¶€êµ° êµ¬ì¡°ëŒ€ê°€ ì ‘ê·¼ ì¤‘ì…ë‹ˆë‹¤.", 
                left: { text: "ë¬´ì‹œí•´", overlay: "ê±°ì§“ë§", effects: { pop: 0, food: 0, san: -10, def: 0 } }, 
                right: { text: "ì‘ë‹µí•´!", overlay: "êµ¬ì¡°!", effects: { pop: 0, food: 0, san: 20, def: -10 } } 
            },
            20: {
                id: 's2', npc: "ë¶ˆì²­ê°", image: "images/stranger.png", 
                text: "[DAY 20] ë¬¸ ì•ì— ê±°ëŒ€í•œ ìƒìê°€ ìˆìŠµë‹ˆë‹¤. 'êµ¬í˜¸ ë¬¼í’ˆ'ì´ë¼ê³  ì í˜€ìˆë„¤ìš”.", 
                left: { text: "ì—´ì§€ë§ˆ", overlay: "í•¨ì •", effects: { pop: 0, food: -10, san: -5, def: 5 } }, 
                right: { text: "ì—´ì–´ë´", overlay: "ëŒ€ë°•", effects: { pop: 5, food: 20, san: 10, def: 0 } } 
            },
            29: {
                id: 's3', npc: "ë³´ì•ˆëŒ€ì¥", image: "images/soldier.png", 
                text: "[DAY 29] ë‚´ì¼ì´ë©´ í—¬ê¸°ê°€ ë„ì°©í•©ë‹ˆë‹¤! ì˜¤ëŠ˜ ë°¤ë§Œ ë²„í‹°ë©´ ë©ë‹ˆë‹¤!", 
                left: { text: "ê²½ê³„í•´", overlay: "ì² ì €", effects: { pop: 0, food: -5, san: -5, def: 10 } }, 
                right: { text: "íŒŒí‹°í•˜ì", overlay: "ì¶•ë°°", effects: { pop: 5, food: -20, san: 20, def: -10 } } 
            }
        };

        // [ëœë¤ ì´ë²¤íŠ¸] - í‰ì†Œì— ë‚˜ì˜¤ëŠ” ì¹´ë“œ
        const randomEvents = [
            { npc: "ìš”ë¦¬ì‚¬", image: "images/chef.png", text: "ìœ í†µê¸°í•œ ì§€ë‚œ ê³ ê¸°ë¥¼ ë°œê²¬í–ˆì–´. ë¨¹ì„ê¹Œ?", left: { text: "ë¨¹ì", overlay: "ëƒ ëƒ ", effects: { pop: -5, food: 15, san: -5, def: 0 } }, right: { text: "ë²„ë ¤", overlay: "í‰¤", effects: { pop: 0, food: -10, san: 5, def: 0 } } },
            { npc: "ë³´ì•ˆëŒ€ì¥", image: "images/soldier.png", text: "ë¬¸ ë°–ì— ê·¸ë¦¼ìê°€ ë³´ì—¬. ì ê¹Œ?", left: { text: "ëŒ€ê¸°í•´", overlay: "ì‹ ì¤‘", effects: { pop: 0, food: 0, san: -5, def: -5 } }, right: { text: "ë°œí¬!", overlay: "ë¹µ!", effects: { pop: 0, food: 0, san: -5, def: 5 } } },
            { npc: "ê¼¬ë§ˆ", image: "images/kid.png", text: "ì‹¬ì‹¬í•´ìš”. ë²½ì— ê·¸ë¦¼ ê·¸ë ¤ë„ ë¼ìš”?", left: { text: "ê·¸ë ¤", overlay: "í—ˆë½", effects: { pop: 0, food: 0, san: 10, def: -5 } }, right: { text: "ì•ˆë¼", overlay: "ê¸ˆì§€", effects: { pop: 0, food: 0, san: -5, def: 0 } } },
            { npc: "ì˜ì‚¬", image: "images/doctor.png", text: "ì•½í’ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ë¯¼ê°„ ìš”ë²•ì„ ì“¸ê¹Œìš”?", left: { text: "ì¨ë³´ì", overlay: "ë„ì „", effects: { pop: -5, food: 0, san: 5, def: 0 } }, right: { text: "ì•ˆë¼", overlay: "ì›ì¹™", effects: { pop: 0, food: 0, san: -5, def: 0 } } },
            { npc: "ì„±ì§ì", image: "images/priest.png", text: "ì‚¬ëŒë“¤ì´ ë¶ˆì•ˆí•´í•©ë‹ˆë‹¤. ì˜ˆë°°ë¥¼ ë“œë¦´ê¹Œìš”?", left: { text: "ì¢‹ì•„", overlay: "ê¸°ë„", effects: { pop: 0, food: 0, san: 15, def: -5 } }, right: { text: "ì¼í•´ë¼", overlay: "ë…¸ë™", effects: { pop: -5, food: 5, san: -10, def: 5 } } },
            { npc: "ë³´ê¸‰ê´€", image: "images/trader.png", text: "ìƒì¸ì´ ì™”ìŠµë‹ˆë‹¤. ë¬´ê¸°ë‘ ì‹ëŸ‰ì„ ë°”ê¿€ê¹Œìš”?", left: { text: "ê±°ë˜", overlay: "êµí™˜", effects: { pop: 0, food: 20, san: 0, def: -15 } }, right: { text: "ê±°ì ˆ", overlay: "í•„ìš”ì—†ì–´", effects: { pop: 0, food: -5, san: 0, def: 0 } } },
            { npc: "ê¸°ìˆ ì", image: "images/mechanic.png", text: "ë‚œë°©ê¸°ê°€ ê³ ì¥ë‚¬ìŠµë‹ˆë‹¤. ë¶€í’ˆì´ ì—†ëŠ”ë° ì–´ì©Œì£ ?", left: { text: "ëœ¯ì–´ê³ ì³", overlay: "ìˆ˜ë¦¬", effects: { pop: 0, food: 0, san: -5, def: 5 } }, right: { text: "ì°¸ì•„", overlay: "ì¶”ìœ„", effects: { pop: -10, food: 0, san: -5, def: 0 } } },
            { npc: "ë¯¸ì¹˜ê´‘ì´", image: "images/crazy.png", text: "ì €ë“¤ì´ ìš°ë¦´ ê°ì‹œí•˜ê³  ìˆì–´! ì¹´ë©”ë¼ë¥¼ ë¶€ìˆ´!", left: { text: "ì§„ì •í•´", overlay: "ì›Œì›Œ", effects: { pop: 0, food: 0, san: -5, def: 0 } }, right: { text: "ê²©ë¦¬í•´", overlay: "ê°ê¸ˆ", effects: { pop: -5, food: 0, san: 5, def: 5 } } },
            { npc: "ê°œ", image: "images/dog.png", text: "ë©! ë©! (ê¼¬ë¦¬ë¥¼ í”ë“ ë‹¤)", left: { text: "ì“°ë‹¤ë“¬ê¸°", overlay: "íë§", effects: { pop: 0, food: 0, san: 10, def: 0 } }, right: { text: "ë¹„ì¼œ", overlay: "ëƒ‰ì •", effects: { pop: 0, food: 0, san: -5, def: 0 } } },
            { npc: "ì™¸ë¶€ì¸", image: "images/stranger.png", text: "ì‚´ë ¤ì£¼ì„¸ìš”! ì „ ê°ì—¼ë˜ì§€ ì•Šì•˜ì–´ìš”!", left: { text: "ë“¤ì–´ì™€", overlay: "êµ¬ì¡°", effects: { pop: 5, food: -10, san: 0, def: -5 } }, right: { text: "êº¼ì ¸", overlay: "ê±°ë¶€", effects: { pop: 0, food: 0, san: -5, def: 5 } } }
        ];

        let stats = { pop: 50, food: 50, def: 50, san: 50 };
        let day = 1;
        let currentEvent = null;
        let isProcessing = false;

        const dom = {
            day: document.getElementById('day-counter'),
            card: document.getElementById('card'),
            npcImg: document.getElementById('npc-img'),
            altText: document.getElementById('alt-text'),
            npcName: document.getElementById('npc-name'),
            question: document.getElementById('question-text'),
            bars: { pop: document.getElementById('bar-pop'), food: document.getElementById('bar-food'), def: document.getElementById('bar-def'), san: document.getElementById('bar-san') },
            btns: { left: document.getElementById('btn-left'), right: document.getElementById('btn-right') },
            overlays: { left: document.getElementById('overlay-left'), right: document.getElementById('overlay-right') },
            result: { screen: document.getElementById('result-screen'), title: document.getElementById('result-title'), desc: document.getElementById('result-desc') }
        };

        function startGame() {
            stats = { pop: 50, food: 50, def: 50, san: 50 };
            day = 1;
            dom.result.screen.classList.add('hidden');
            dom.result.title.classList.remove('ending-win');
            updateUI();
            loadNextEvent();
        }

        function loadNextEvent() {
            // [1] ì—”ë”© ì²´í¬: ëª©í‘œ ë‚ ì§œ ë„ë‹¬ ì‹œ
            if (day > TARGET_DAY) {
                showResult("VICTORY", "êµ¬ì¡° í—¬ê¸°ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤! ë‹¹ì‹ ì€ ë²™ì»¤ë¥¼ ì§€ì¼œëƒˆìŠµë‹ˆë‹¤.", true);
                return;
            }

            // UI ì´ˆê¸°í™”
            dom.card.className = ''; dom.card.style.opacity = 1;
            dom.overlays.left.style.opacity = 0; dom.overlays.right.style.opacity = 0;
            
            // [2] ìŠ¤í† ë¦¬ ì´ë²¤íŠ¸ ì²´í¬ (ìš°ì„ ìˆœìœ„ ë†’ìŒ)
            if (storyEvents[day]) {
                currentEvent = storyEvents[day];
            } else {
                // ëœë¤ ì´ë²¤íŠ¸
                const randomIdx = Math.floor(Math.random() * randomEvents.length);
                currentEvent = randomEvents[randomIdx];
            }
            
            // ë°ì´í„° ë°”ì¸ë”©
            dom.npcImg.style.display = 'block';
            dom.altText.style.display = 'none';
            dom.npcImg.src = currentEvent.image;
            dom.npcImg.onerror = function() { this.style.display = 'none'; dom.altText.innerText = currentEvent.npc; dom.altText.style.display = 'block'; };

            dom.npcName.innerText = currentEvent.npc;
            dom.question.innerText = currentEvent.text;
            dom.btns.left.innerText = currentEvent.left.text;
            dom.btns.right.innerText = currentEvent.right.text;
            dom.overlays.left.innerText = currentEvent.left.overlay;
            dom.overlays.right.innerText = currentEvent.right.overlay;

            isProcessing = false;
            dom.btns.left.disabled = false;
            dom.btns.right.disabled = false;
        }

        function handleChoice(direction) {
            if (isProcessing) return;
            isProcessing = true;
            dom.btns.left.disabled = true; dom.btns.right.disabled = true;

            const choice = direction === 'left' ? currentEvent.left : currentEvent.right;
            dom.overlays[direction].style.opacity = 1;
            dom.card.classList.add(direction === 'left' ? 'swipe-left' : 'swipe-right');

            // í†µê³„ ì ìš©
            stats.pop += choice.effects.pop;
            stats.food += choice.effects.food;
            stats.def += choice.effects.def;
            stats.san += choice.effects.san;
            
            // ë‚ ì§œ ì¦ê°€
            day++;
            updateUI();

            setTimeout(() => {
                const deathReason = checkGameOver();
                if (deathReason) {
                    showResult("GAME OVER", deathReason, false);
                } else {
                    loadNextEvent();
                }
            }, 500);
        }

        function updateUI() {
            dom.day.innerText = `DAY ${day} / ${TARGET_DAY}`;
            for (let key in stats) {
                if (stats[key] > 100) stats[key] = 100;
                if (stats[key] < 0) stats[key] = 0;
                dom.bars[key].style.width = stats[key] + '%';
            }
        }

        function checkGameOver() {
            if (stats.pop <= 0) return "ëª¨ë‘ê°€ ì£½ì—ˆìŠµë‹ˆë‹¤. [ì¸êµ¬ 0]";
            if (stats.pop >= 100) return "ê³¼ë°€ë¡œ ì§ˆì‹í–ˆìŠµë‹ˆë‹¤. [ì¸êµ¬ MAX]";
            if (stats.food <= 0) return "êµ¶ì–´ ì£½ì—ˆìŠµë‹ˆë‹¤. [ì‹ëŸ‰ 0]";
            if (stats.food >= 100) return "ìŒì‹ì´ ì©ì–´ ì—­ë³‘ì´ ë•ë‹ˆë‹¤. [ì‹ëŸ‰ MAX]";
            if (stats.def <= 0) return "ë²™ì»¤ê°€ í•¨ë½ë˜ì—ˆìŠµë‹ˆë‹¤. [ë¬´ë ¥ 0]";
            if (stats.def >= 100) return "ì¿ ë°íƒ€ë¡œ ì²˜í˜•ë‹¹í–ˆìŠµë‹ˆë‹¤. [ë¬´ë ¥ MAX]";
            if (stats.san <= 0) return "í­ë™ìœ¼ë¡œ ì«“ê²¨ë‚¬ìŠµë‹ˆë‹¤. [ì´ì„± 0]";
            if (stats.san >= 100) return "ê´‘ì‹ ë„ë“¤ì˜ ì œë¬¼ì´ ë˜ì—ˆìŠµë‹ˆë‹¤. [ì´ì„± MAX]";
            return null;
        }

        function showResult(title, desc, isWin) {
            dom.result.title.innerText = title;
            dom.result.desc.innerText = desc;
            if (isWin) {
                dom.result.title.classList.add('ending-win');
                dom.result.title.innerText = "ğŸ‰ SURVIVED! ğŸ‰";
            }
            dom.result.screen.classList.remove('hidden');
        }

        dom.btns.left.addEventListener('click', () => handleChoice('left'));
        dom.btns.right.addEventListener('click', () => handleChoice('right'));
        document.addEventListener('keydown', (e) => {
            if (!dom.result.screen.classList.contains('hidden')) return;
            if (e.key === 'ArrowLeft') handleChoice('left');
            if (e.key === 'ArrowRight') handleChoice('right');
        });

        startGame();
    </script>
</body>
</html>